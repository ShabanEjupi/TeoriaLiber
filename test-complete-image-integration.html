<!DOCTYPE html>
<html lang="sq">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🧪 Test Complete Image Integration</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2E8B57, #3CB371);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .test-area {
            padding: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: #f9f9f9;
        }
        
        .test-section h3 {
            color: #2E8B57;
            margin-top: 0;
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
        }
        
        button {
            background: linear-gradient(135deg, #2E8B57, #3CB371);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .status-area {
            margin: 20px 0;
            padding: 15px;
            background: #f0f8ff;
            border-left: 4px solid #2E8B57;
            border-radius: 5px;
        }
        
        .chapter-preview {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .image-grid-test {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .image-test-item {
            text-align: center;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: white;
        }
        
        .image-test-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .console-output {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin: 20px 0;
        }
        
        .stats-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 15px 0;
        }
        
        .stats-card h4 {
            margin: 0 0 10px 0;
            font-size: 1.2rem;
        }
        
        .stats-card .number {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🧪 Test Complete Image Integration</h1>
            <p>Comprehensive testing for all images in the Game Theory book</p>
        </div>
        
        <div class="test-area">
            <!-- Basic Integration Test -->
            <div class="test-section">
                <h3>🔧 Basic Integration Test</h3>
                <p>Test if all image maps and functions are properly loaded.</p>
                <div class="button-group">
                    <button onclick="runBasicTest()">🚀 Run Basic Test</button>
                    <button onclick="checkImageMaps()">📊 Check Image Maps</button>
                    <button onclick="testImageFunctions()">⚙️ Test Functions</button>
                </div>
                <div id="basic-status" class="status-area">Ready to test...</div>
            </div>
            
            <!-- Image Usage Statistics -->
            <div class="test-section">
                <h3>📈 Image Usage Statistics</h3>
                <p>Check which images are used and which are still available for integration.</p>
                <div class="button-group">
                    <button onclick="checkImageUsage()">📊 Check Usage</button>
                    <button onclick="findUnusedImages()">🔍 Find Unused</button>
                    <button onclick="showImageStats()">📈 Show Stats</button>
                </div>
                <div id="stats-container"></div>
            </div>
            
            <!-- Chapter Preview Test -->
            <div class="test-section">
                <h3>👁️ Chapter Preview Test</h3>
                <p>Preview how images appear in actual chapters.</p>
                <div class="button-group">
                    <button onclick="previewChapter(1)">📖 Chapter 1</button>
                    <button onclick="previewChapter(6)">💒 Chapter 6 (Wedding)</button>
                    <button onclick="previewChapter(23)">🚀 Chapter 23 (AI)</button>
                    <button onclick="previewRandomChapter()">🎲 Random Chapter</button>
                </div>
                <div id="chapter-preview" class="chapter-preview" style="display: none;"></div>
            </div>
            
            <!-- Image Loading Test -->
            <div class="test-section">
                <h3>🖼️ Image Loading Test</h3>
                <p>Test if images are actually accessible and loading properly.</p>
                <div class="button-group">
                    <button onclick="testImageLoading()">🔄 Test Loading</button>
                    <button onclick="showImageGallery()">🖼️ Show Gallery</button>
                    <button onclick="validateAllImages()">✅ Validate All</button>
                </div>
                <div id="image-gallery" class="image-grid-test" style="display: none;"></div>
            </div>
            
            <!-- Download Test -->
            <div class="test-section">
                <h3>📥 Download Integration Test</h3>
                <p>Test if images are properly included in the downloadable book.</p>
                <div class="button-group">
                    <button onclick="testDownloadWithImages()">📥 Test Download</button>
                    <button onclick="generateSampleChapter()">📄 Sample Chapter</button>
                    <button onclick="validateDownload()">✅ Validate Download</button>
                </div>
                <div id="download-status" class="status-area">Ready to test download...</div>
            </div>
            
            <!-- Console Output -->
            <div class="test-section">
                <h3>🖥️ Console Output</h3>
                <button onclick="clearConsoleOutput()">🗑️ Clear Console</button>
                <div id="console-output" class="console-output">Console output will appear here...</div>
            </div>
        </div>
    </div>

    <!-- Load required scripts -->
    <script src="script.js"></script>
    <script src="complete-image-integration.js"></script>
    <script src="test-image-integration.js"></script>
    <script src="download-fix-consolidated.js"></script>
    
    <script>
        let consoleDiv = document.getElementById('console-output');
        
        // Override console.log to show in our div
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.join(' ');
            consoleDiv.innerHTML += `[LOG] ${message}\n`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            const message = args.join(' ');
            consoleDiv.innerHTML += `[ERROR] ${message}\n`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };
        
        // Test functions
        function runBasicTest() {
            const statusDiv = document.getElementById('basic-status');
            statusDiv.innerHTML = '🔄 Running basic test...';
            
            console.log('🚀 Starting Basic Integration Test...');
            
            // Test if main components are loaded
            let status = [];
            
            if (typeof completeImageMap !== 'undefined') {
                status.push('✅ Complete image map loaded');
                console.log(`📊 Total images in map: ${Object.keys(completeImageMap).length}`);
            } else {
                status.push('❌ Complete image map not loaded');
            }
            
            if (typeof enhancedChapterImageMap !== 'undefined') {
                status.push('✅ Enhanced chapter mapping loaded');
                console.log(`📚 Chapters with images: ${Object.keys(enhancedChapterImageMap).length}`);
            } else {
                status.push('❌ Enhanced chapter mapping not loaded');
            }
            
            if (typeof generateChapterImageGallery === 'function') {
                status.push('✅ Image gallery function available');
            } else {
                status.push('❌ Image gallery function not available');
            }
            
            if (typeof getChapterImages === 'function') {
                status.push('✅ Chapter images function available');
            } else {
                status.push('❌ Chapter images function not available');
            }
            
            statusDiv.innerHTML = status.join('<br>');
            console.log('✅ Basic test completed');
        }
        
        function checkImageMaps() {
            console.log('🔍 Checking image maps...');
            
            if (typeof completeImageMap === 'undefined') {
                console.error('❌ Complete image map not available');
                return;
            }
            
            const totalImages = Object.keys(completeImageMap).length;
            console.log(`📊 Total images available: ${totalImages}`);
            
            // Show some sample images
            const sampleKeys = Object.keys(completeImageMap).slice(0, 5);
            console.log('📋 Sample images:');
            sampleKeys.forEach(key => {
                console.log(`  - ${key}: ${completeImageMap[key].split('/').pop().substring(0, 50)}...`);
            });
        }
        
        function testImageFunctions() {
            console.log('⚙️ Testing image functions...');
            
            if (typeof getChapterImages === 'function') {
                console.log('🧪 Testing getChapterImages...');
                for (let i = 1; i <= 5; i++) {
                    const images = getChapterImages(i);
                    console.log(`  Chapter ${i}: ${images.length} images`);
                }
            }
            
            if (typeof generateChapterImageGallery === 'function') {
                console.log('🧪 Testing generateChapterImageGallery...');
                const gallery = generateChapterImageGallery(1);
                if (gallery && gallery.length > 0) {
                    console.log('✅ Gallery generation successful');
                } else {
                    console.log('⚠️ Gallery generation returned empty');
                }
            }
        }
        
        function checkImageUsage() {
            console.log('📊 Checking image usage...');
            
            if (typeof testUnusedImages === 'function') {
                const results = testUnusedImages();
                
                // Create stats display
                const statsContainer = document.getElementById('stats-container');
                statsContainer.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="stats-card">
                            <h4>📊 Total Images</h4>
                            <div class="number">${results.total}</div>
                        </div>
                        <div class="stats-card">
                            <h4>✅ Used Images</h4>
                            <div class="number">${results.used}</div>
                        </div>
                        <div class="stats-card">
                            <h4>⚠️ Unused Images</h4>
                            <div class="number">${results.unused}</div>
                        </div>
                        <div class="stats-card">
                            <h4>📈 Usage Rate</h4>
                            <div class="number">${Math.round((results.used / results.total) * 100)}%</div>
                        </div>
                    </div>
                `;
            }
        }
        
        function findUnusedImages() {
            console.log('🔍 Finding unused images...');
            
            if (typeof testUnusedImages === 'function') {
                const results = testUnusedImages();
                
                if (results.unusedImages.length > 0) {
                    console.log('📋 Unused images that could be integrated:');
                    results.unusedImages.forEach(key => {
                        console.log(`  - ${key}`);
                    });
                } else {
                    console.log('✅ All images are being used!');
                }
            }
        }
        
        function showImageStats() {
            checkImageUsage();
            findUnusedImages();
        }
        
        function previewChapter(chapterNum) {
            console.log(`👁️ Previewing chapter ${chapterNum}...`);
            
            const previewDiv = document.getElementById('chapter-preview');
            previewDiv.style.display = 'block';
            
            if (typeof generateChapterContent === 'function' && typeof getChapterTitle === 'function') {
                const title = getChapterTitle(chapterNum);
                const content = generateChapterContent(chapterNum, title);
                previewDiv.innerHTML = content;
                console.log(`✅ Chapter ${chapterNum} preview generated`);
            } else {
                previewDiv.innerHTML = '<p>❌ Chapter generation functions not available</p>';
                console.error('❌ Chapter functions not available');
            }
        }
        
        function previewRandomChapter() {
            const randomChapter = Math.floor(Math.random() * 60) + 1;
            console.log(`🎲 Randomly selected chapter ${randomChapter}`);
            previewChapter(randomChapter);
        }
        
        function testImageLoading() {
            console.log('🔄 Testing image loading...');
            
            if (typeof completeImageMap === 'undefined') {
                console.error('❌ Image map not available');
                return;
            }
            
            const testImages = Object.values(completeImageMap).slice(0, 10);
            let loadedCount = 0;
            let errorCount = 0;
            
            testImages.forEach((imagePath, index) => {
                const img = new Image();
                img.onload = () => {
                    loadedCount++;
                    console.log(`✅ Image ${index + 1} loaded successfully`);
                    updateLoadingProgress();
                };
                
                img.onerror = () => {
                    errorCount++;
                    console.error(`❌ Failed to load image ${index + 1}`);
                    updateLoadingProgress();
                };
                
                img.src = imagePath;
            });
            
            function updateLoadingProgress() {
                if (loadedCount + errorCount === testImages.length) {
                    console.log(`📈 Loading test complete: ${loadedCount}/${testImages.length} successful`);
                }
            }
        }
        
        function showImageGallery() {
            console.log('🖼️ Showing image gallery...');
            
            const galleryDiv = document.getElementById('image-gallery');
            galleryDiv.style.display = 'grid';
            galleryDiv.innerHTML = '';
            
            if (typeof completeImageMap === 'undefined') {
                galleryDiv.innerHTML = '<p>❌ Image map not available</p>';
                return;
            }
            
            const sampleImages = Object.entries(completeImageMap).slice(0, 12);
            
            sampleImages.forEach(([key, path]) => {
                const item = document.createElement('div');
                item.className = 'image-test-item';
                item.innerHTML = `
                    <img src="${path}" alt="${key}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEyMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkVycm9yPC90ZXh0Pjwvc3ZnPg==';">
                    <small>${key}</small>
                `;
                galleryDiv.appendChild(item);
            });
            
            console.log(`🖼️ Gallery showing ${sampleImages.length} sample images`);
        }
        
        function validateAllImages() {
            console.log('✅ Validating all images...');
            testImageLoading();
        }
        
        function testDownloadWithImages() {
            console.log('📥 Testing download with images...');
            
            const statusDiv = document.getElementById('download-status');
            statusDiv.innerHTML = '🔄 Testing download functionality...';
            
            if (typeof downloadBook === 'function') {
                console.log('✅ Download function available');
                statusDiv.innerHTML = '✅ Download function available - you can test the actual download';
            } else {
                console.error('❌ Download function not available');
                statusDiv.innerHTML = '❌ Download function not available';
            }
        }
        
        function generateSampleChapter() {
            console.log('📄 Generating sample chapter...');
            previewChapter(1);
        }
        
        function validateDownload() {
            console.log('✅ Validating download integration...');
            testDownloadWithImages();
        }
        
        function clearConsoleOutput() {
            consoleDiv.innerHTML = 'Console cleared...\n';
        }
        
        // Auto-run initial test when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎬 Image Integration Test Page Loaded');
            console.log('📝 Use the buttons above to run various tests');
            console.log('🚀 Running auto-test in 2 seconds...');
            
            setTimeout(() => {
                runBasicTest();
            }, 2000);
        });
    </script>
</body>
</html>
